# 사주풀이 서비스 PRD (Product Requirements Document)

## 1. 프로젝트 개요
사용자의 생년월일시 정보를 입력받아 LLM을 통해 상세한 사주 분석 레포트를 제공하는 웹 서비스

### 기술 스택
- **프레임워크**: SvelteKit
- **언어**: TypeScript
- **스타일링**: TailwindCSS
- **데이터베이스**: SQLite (만세력 데이터)
- **LLM**: OpenAI, Claude, Gemini
- **저장소**: 파일 시스템 (JSON)

## 2. 핵심 기능

### 2.1 사용자 정보 입력
- **필수 입력 항목**:
  - 성별 (남/여)
  - 생년월일 (YYYY-MM-DD)
  - 출생 시간 (HH:mm)
  - 달력 구분 (양력/음력)
  - 윤달 여부 (음력 선택 시)
- **선택 입력 항목**:
  - 이름

### 2.2 사주 분석 레포트
- **레포트 구성**:
  1. XXX 님의 사주: 사주 요약정보, 생시, 생일, 생월, 생년 등의 사주팔자 정보
  2. 사주 한마디: 6개월 사주의 한문장 (50자 미만)
  3. 내 사주에서 가장 강한 오행 (1000자)
  4. 나에게 주는 성격적 영향 (1000자)
  5. 대인 관계에서의 작용 (1000자)
  6. 이 오행이 강할 때의 문제점 (1000자)
  7. 오행의 기운을 조화롭게 다스리는 법 (1000자)
  8. 향후 5년 (1000자)
  9. 마무리 (1000자)

## 3. 시스템 아키텍처

### 3.1 디렉토리 구조
```
fortune/
├── src/
│   ├── lib/
│   │   ├── saju/
│   │   │   ├── core/
│   │   │   │   └── calculator.ts    # 기존 사주 계산 로직
│   │   │   ├── types/
│   │   │   │   └── index.ts         # 사주 관련 타입 정의
│   │   │   ├── services/
│   │   │   │   └── analyzer.ts      # 사주 분석 서비스
│   │   │   └── prompts/
│   │   │       ├── saju-basic.md    # 사주 분석 프롬프트
│   │   │       └── index.ts         # 프롬프트 로더
│   │   └── llm/
│   │       ├── types.ts             # LLM 인터페이스
│   │       ├── providers/
│   │       │   ├── openai.ts        # OpenAI 프로바이더
│   │       │   ├── claude.ts        # Claude 프로바이더
│   │       │   └── gemini.ts        # Gemini 프로바이더
│   │       └── factory.ts           # 프로바이더 팩토리
│   ├── routes/
│   │   ├── api/
│   │   │   └── saju/
│   │   │       ├── analyze/
│   │   │       │   └── +server.ts   # 사주 분석 API
│   │   │       └── report/[id]/
│   │   │           └── +server.ts   # 레포트 조회 API
│   │   └── saju/
│   │       ├── +page.svelte         # 입력 폼 페이지
│   │       └── report/
│   │           └── +page.svelte     # 레포트 표시 페이지
│   └── app.html
├── data/
│   ├── manses.db                    # 만세력 데이터베이스
│   └── reports/                     # 생성된 레포트 저장
│       └── YYYY-MM-DD-HHmm.json    # 생년월일시로 명명
├── .env                             # 환경 변수 (API 키)
└── package.json
```

### 3.2 데이터 플로우
1. 사용자가 생년월일시 정보 입력
2. SajuCalculator를 통해 기본 사주 데이터 추출
3. LLM 프로바이더를 통해 사주 분석 요청
4. 분석 결과를 JSON 파일로 저장 (생년월일시 기준)
5. 사용자에게 레포트 표시

## 4. 기술 상세

### 4.1 LLM 프로바이더 시스템
- **인터페이스 기반 설계**로 프로바이더 교체 가능
- **지원 LLM**: OpenAI GPT-4, Claude, Gemini
- **환경 변수**로 API 키 관리
- **프로바이더 선택**: 환경 변수 또는 런타임 설정

### 4.2 프롬프트 관리
- **Markdown 파일**로 프롬프트 관리 (`.md`)
- **변수 치환**: 사용자 정보와 사주 데이터 삽입
- **버전 관리**: Git을 통한 프롬프트 이력 추적

### 4.3 데이터 저장
- **파일 기반**: JSON 형식으로 레포트 저장
- **파일명 규칙**: `YYYY-MM-DD-HHmm.json`
- **저장 위치**: `data/reports/` 디렉토리

## 5. UI/UX 요구사항

### 5.1 입력 폼 페이지
- 직관적인 폼 디자인
- 실시간 유효성 검사
- 양력/음력 토글
- 시간 선택기

### 5.2 레포트 페이지
- 깔끔한 레이아웃
- 섹션별 구분
- 인쇄 친화적 디자인
- 모바일 반응형

## 6. 구현 순서

### Phase 1: UI 구현
1. **입력 폼 페이지 개발** (`/saju`)
   - 사용자 정보 입력 폼
   - 유효성 검사
   - 양력/음력 전환 UI

2. **레포트 표시 페이지** (`/saju/report`)
   - 레포트 레이아웃 구성
   - 섹션별 컴포넌트 개발
   - 모바일 반응형 디자인

### Phase 2: 백엔드 기초
3. **LLM 프로바이더 시스템 구축**
   - 환경 변수 설정 (.env)
   - LLM 인터페이스 정의
   - OpenAI, Claude, Gemini 프로바이더 구현

4. **프롬프트 관리 시스템 생성**
   - 사주 분석 프롬프트 작성 (Markdown)
   - 프롬프트 로더 구현

### Phase 3: 서비스 통합
5. **사주 분석 서비스 구현**
   - SajuCalculator 활용한 기본 사주 데이터 추출
   - LLM을 통한 사주 분석 레포트 생성

6. **API 엔드포인트 개발**
   - 사주 분석 API
   - 레포트 조회 API

### Phase 4: 테스트 및 개선
7. **테스트 작성**
   - 단위 테스트 (Vitest)
   - E2E 테스트 (Playwright)