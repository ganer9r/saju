# 사주풀이 서비스 TRD (Technical Requirements Document)

## 1. 개요

### 1.1 목적
본 문서는 사주풀이 서비스의 기술적 요구사항을 정의하고, 시스템 설계 및 구현을 위한 기술적 가이드라인을 제공한다.

### 1.2 범위
- 사용자 정보 입력 및 검증
- 사주 계산 및 분석
- LLM 기반 사주 해석
- 레포트 생성 및 저장
- 웹 기반 사용자 인터페이스

### 1.3 용어 정의
- **사주팔자**: 생년월일시를 기준으로 한 네 기둥(년주, 월주, 일주, 시주)
- **만세력**: 음양력 변환 및 천간지지 데이터베이스
- **LLM**: Large Language Model (대규모 언어 모델)

## 2. 기능 요구사항

### 2.1 사용자 정보 입력
- 성별, 생년월일, 출생시간 입력
- 양력/음력 선택 기능
- 출생시간 미상 처리
- 입력값 유효성 검증

### 2.2 사주 계산
- 만세력 데이터베이스 조회
- 사주팔자 추출
- 시주 계산 알고리즘

### 2.3 사주 분석
- LLM을 통한 사주 해석
- 구조화된 레포트 생성
- 오행 분석 및 운세 예측

### 2.4 레포트 관리
- 레포트 저장 및 조회
- 공유 가능한 URL 생성
- 중복 분석 방지 (캐싱)

## 3. 비기능 요구사항

### 3.1 성능
- 페이지 로드 시간: 3초 이내
- LLM 응답 시간: 5분 이내
- 동시 사용자 지원: 100명

### 3.2 가용성
- 서비스 가용성: 99% (프로토타입)
- 에러 복구: 자동 재시도 메커니즘

### 3.3 확장성
- LLM 프로바이더 교체 가능
- 다국어 지원 고려
- 모듈식 아키텍처

### 3.4 보안
- API 키 보호
- 입력 데이터 검증
- HTTPS 통신

### 3.5 사용성
- 반응형 웹 디자인
- 직관적인 사용자 인터페이스
- 명확한 에러 메시지

## 4. 시스템 아키텍처

### 4.1 아키텍처 패턴
- **패턴**: MVC with Server-Side Rendering
- **프레임워크**: SvelteKit
- **배포 모델**: Node.js 서버 애플리케이션

### 4.2 주요 컴포넌트
1. **Web Client**: 사용자 인터페이스
2. **Application Server**: 비즈니스 로직 처리
3. **Data Layer**: SQLite (만세력), File System (레포트)
4. **External Services**: LLM API 연동

### 4.3 데이터 흐름
1. 사용자 입력 → 서버 검증
2. 만세력 조회 → 사주 계산
3. LLM 분석 요청 → 레포트 생성
4. 파일 저장 → 결과 반환

## 5. 기술 스택

### 5.4 Development Tools
- **Testing**: Vitest, Playwright
- **Code Quality**: ESLint, Prettier
- **Version Control**: Git

## 6. 인터페이스 요구사항

### 6.1 사용자 인터페이스
- **입력 폼**: 사용자 정보 수집
- **로딩 화면**: 분석 진행 상태 표시
- **레포트 뷰**: 분석 결과 표시
- **공유 기능**: URL 복사

### 6.2 API 인터페이스
- **RESTful API**: JSON 기반 통신
- **Endpoints**:
  - POST /api/saju/analyze
  - GET /api/saju/report/[id]

### 6.3 외부 시스템 연동
- **LLM Provider API**: Claude, OpenAI, Gemini
- **환경 변수**: API 키 관리

## 7. 데이터 요구사항

### 7.1 데이터 저장
- **만세력**: SQLite 데이터베이스 (읽기 전용)
- **레포트**: JSON 파일 (파일명: YYYY-MM-DD-HHmm.json)
- **캐싱**: 동일 생년월일시 중복 방지

### 7.2 데이터 보존
- **레포트 보존**: 영구 저장 (프로토타입)
- **백업**: 수동 백업 (추후 자동화)

## 8. 제약사항

### 8.1 기술적 제약
- 서버 사이드 렌더링 필수
- 파일 시스템 기반 저장 (DB 미사용)
- 단일 서버 운영

### 8.2 비즈니스 제약
- 한국어 서비스만 지원
- 인증/권한 시스템 없음 (프로토타입)
- 무료 서비스

### 8.3 외부 의존성
- LLM API 가용성에 의존
- API 사용량 제한 고려

## 9. 품질 보증

### 9.1 테스트 전략
- **단위 테스트**: 핵심 로직 검증
- **통합 테스트**: API 엔드포인트
- **E2E 테스트**: 주요 사용자 시나리오
- **Mock 테스트**: LLM Provider

### 9.2 품질 기준
- 코드 커버리지: 70% 이상
- 응답 시간: SLA 준수
- 에러율: 1% 미만

## 10. 운영 요구사항

### 10.3 유지보수
- **프롬프트 관리**: Markdown 파일로 버전 관리
- **LLM 프로바이더**: 설정으로 교체 가능
- **데이터 정리**: 수동 관리